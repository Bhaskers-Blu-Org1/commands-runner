extension:
  name: app-autoscaler-release
  version: 1.0
  type: bosh-release
uiconfig:
- name: Autoscaler
  title: "Properties for autoscaler service"
  properties:
  - name: servicebroker_port
    label: "Service broker port"
    description: "Port to access service broker"
    type: text
    validation-regex: "^(?:[0-9]{1,4}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$"
    mandatory: true
    hidden: false
    sample-value: "E.g. 35880"
  - name: servicebroker_username
    label: "Service broker username"
    description: "User name for the service broker"
    mandatory: true
    sample-value: "E.g. admin"
    default: "admin"
  - name: servicebroker_password
    label: "Service broker password"
    type: password
    mandatory: true
    sample-value: "E.g. mypassword"
    default: "admin"
  - name: api-port
    label: "API Port"
    description: "Port for api"
    type: text
    validation-regex: "^(?:[0-9]{1,4}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$"
    mandatory: true
    hidden: false
    sample-value: "E.g. 35880"
commands:
  - name: generate_certs
    phase: "AfterDirectorDeployment"
    labal: "Generate certs for deployment"
    state: READY
    start_time: ""
    end_time: ""
    script: ./app-autoscaler-release/generate_certs
    script_timeout: 2
  - name: spruce
    state: READY
    label: "Spruce YML files"
    start_time: ""
    end_time: ""
    script: spruce merge --prune bmxconfig --prune stemcell_release --prune director_releases--prune certificates --prune credentials --prune cf_releases --prune diego_releases --prune NOT_USED_properties ./app-autoscaler-release/templates/bosh-lite-manifest-template-v1.yml ./templates/config-from-cf.yml ./example/property-overrides.yml ./app-autoscaler-release/dbstubs/db-stub-external.yml /data/cfp/CloudFoundry/bmxconfig.yml ./templates/temp/director-uuid.yml  /data/cfp/CloudFoundry/credentials.yml /data/cfp/CloudFoundry/certificates.yml > ./app-autoscaler-release/deployments/autoscaler.yml
  - name: create-release
    state: READY
    label: "create the app autoscaler release"
    start_time: ""
    end_time: ""
    log_path: /data/logs/app-autoscaler-release/app-autoscaler-release.log
    script: bosh -d ./app-autoscaler-release/deployments/autoscaler.yml create-release 
  - name: deploy-release
    state: READY
    label: "deploy the app autoscaler"
    start_time: ""
    end_time: ""
    log_path: /data/logs/app-autoscaler-release/app-autoscaler-release.log
    script: bosh -d ./app-autoscaler-release/deployments/autoscaler.yml deploy
  - name: create-service-broker
    label: "create app autoscaler service broker"
    state: READY
    start_time: ""
    end_time: ""
    log_path: /data/logs/app-autoscaler-release/app-autoscaler-release.log
    script: cf create-service-broker autoscaler username password https://autoscalerservicebroker.bosh-lite.com